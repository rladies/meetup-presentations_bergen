---
title: "Efficient dependency management with {renv}"  
author: "Julia Romanowska"
date: '2023-03-15'
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    nature:
      slideNumberFormat: "%current%"
      highlightStyle: github
      highlightLines: true
      ratio: 16:9
      countIncrementalSlides: true
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  fig.width=9, fig.height=3.5, fig.retina=3,
  out.width = "100%",
  cache = FALSE,
  echo = TRUE,
  message = FALSE, 
  warning = FALSE,
  hiline = TRUE
)

library(fontawesome)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_duo_accent(
  primary_color = "#1381B0",
  secondary_color = "#FF961C",
  inverse_header_color = "#FFFFFF", base_font_size = "22pt"
)
```

## {renv} package

<img src="figures/Screenshot_2023-03-14_Introduction_to_renv.png" alt="Screenshot of the 'Introduction to renv' vignette online. Text that says: 'The renv package is a new effort to bring project-local R dependency management to your projects. The goal is for renv to be a robust, stable replacement for the Packrat package, with fewer surprises and better default behaviors. Underlying the philosophy of renv is that any of your existing workflows should just work as they did before – renv helps manage library paths (and other project-specific state) to help isolate your project’s R dependencies, and the existing tools you’ve used for managing R packages (e.g. install.packages(), remove.packages()) should work as they did before.'" style="width: 80%; position: absolute; left: 10%; top: 150px;">

---

class: inverse, middle, center

## Why?

--

### reproducibility

--

### peace of mind

--

### collaboration

---

## `r fa("lightbulb")` How?

--

1. `renv::init()`

1. work as usual

1. `renv::snapshot()`

1. work as usual

1. `renv::snapshot()` or `renv::restore()`

???


1. Call `renv::init()` to initialize a new project-local environment with a
private R library,

1. Work in the project as normal, installing and removing new R packages as
they are needed in the project,

1. Call `renv::snapshot()` to save the state of the project library to the
lockfile (called renv.lock),

1. Continue working on your project, installing and updating R packages as
needed.

1. Call `renv::snapshot()` again to save the state of your project library if your
attempts to update R packages were successful, or call `renv::restore()` to revert
to the previous state as encoded in the lockfile if your attempts to update
packages introduced some new problems.


---

## Details - file structure

---

## Details - dependency discovery

---

## Details - cache

---

## `r fa("triangle-exclamation")` Caveats

- takes care only of R-packages

- package version needs to be available (online/offline)

- all things reproducibility:    
[Building reproducible analytical pipelines with R](https://raps-with-r.dev/) `r fa("book")`

???

This is not a panaceum! If an R-package depends on an external library, this
will have to be installed manually.

Copy of the version of the package needs to be either online or offline.

---

class: inverse, left, middle

## What next?

- combine with docker `r fa("docker")`

- combine with git/GitHub `r fa("github")`

- combine with CI/GitHub actions `r fa("code-pull-request")`
